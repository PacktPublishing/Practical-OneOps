#
# Dynamically generated by Chef on <%= node["fqdn"] %>
#
# Local modifications will be overwritten by Chef.
#

##Source the environment variables from oneOps

if [ -f /etc/profile.d/oneops.sh ];then
  source /etc/profile.d/oneops.sh
fi


# Directory where the Tomcat 6 binary distribution resides.  This a read-only
# directory that can be shared by all Tomcat instances running on the machine.
# Default: /usr/share/TOMCAT
CATALINA_HOME=<%= node["tomcat"]["home"] %>
CATALINA_PID=<%= node["tomcat"]["home"] %>/tomcat.pid
# Directory for per-instance configuration files and webapps. It contains the
# directories conf, logs, webapps, work and temp. See RUNNING.txt for details.
# Default: /var/lib/TOMCAT
CATALINA_BASE=<%= node["tomcat"]["base"] %>

# You may pass JVM startup parameters to Java here. If unset, the default
# options (-Djava.awt.headless=true) will be used.
CATALINA_OPTS="<%= node["tomcat"]["java_options"] %>"

<% if node["tomcat"]["system_properties"] != nil &&
   JSON.parse(node["tomcat"]["system_properties"]).keys.size > 0
%>
<% opts = JSON.parse(node["tomcat"]["system_properties"]).map{ |k,v| "-D#{k}=#{v} " } %>

CATALINA_OPTS="${CATALINA_OPTS} <%= opts.join(" ") %>"

<% end %>

CATALINA_OPTS="${CATALINA_OPTS} -Xmx<%= node["tomcat"]["mem_max"] %>"
CATALINA_OPTS="${CATALINA_OPTS} -Xms<%= node["tomcat"]["mem_start"] %>"
CATALINA_OPTS="${CATALINA_OPTS} -d64 "

<% opts = JSON.parse(node["tomcat"]["startup_params"]).map{ |v| "-XX:#{v} " } %>
<% opts_str = opts.join(" ") %>
CATALINA_OPTS="${CATALINA_OPTS} <%= opts_str %>"

<% if node["tomcat"]["environment"] != nil &&
   JSON.parse(node["tomcat"]["environment"]).keys.size > 0
%>
<% JSON.parse(node["tomcat"]["environment"]).each{ |k, v|%>
export <%=k%>="<%=v%>"
<% } %>
<% end %>

LOGFILES_PATH="<%= node["tomcat"]["logfiles_path"] %>"
CATALINA_OUT="${LOGFILES_PATH}/catalina.out"
