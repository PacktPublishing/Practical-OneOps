###############################################################################
# Dynamically generated by Chef on <%= node['fqdn'] %>
#
# Local modifications will be overwritten by Chef.
###############################################################################

###############################################################################
# Source Environment Variables From OneOps
###############################################################################
if [ -f /etc/profile.d/oneops.sh ];then
  source /etc/profile.d/oneops.sh
fi

###############################################################################
#   CATALINA_HOME   Directory where the Tomcat binary distribution resides. this
#                   is a read-only directory that can be shared by all Tomcat
#                   instances running on the machine.
#   Default         /usr/share/tomcat
###############################################################################
CATALINA_HOME=<%= node['tomcat']['instance_dir'] %>

###############################################################################
#   JRE_HOME        Must point at your Java Runtime installation.
#   Default         Value of JAVA_HOME
###############################################################################
JRE_HOME=<%= node['tomcat']['java']['jre_home'] %>

###############################################################################
#   CATALINA_BASE   Directory for per-instance configuration files and webapps.
#                   It contains the directories: conf, logs, webapps, work, and
#   Default         /var/lib/tomcat
###############################################################################
CATALINA_BASE=<%= node['tomcat']['instance_dir'] %>

###############################################################################
#   CATALINA_PID    Path of the file which should contains the pid of the
#                   catalina startup java process, when start (fork) is used
###############################################################################
CATALINA_PID=<%= node['tomcat']['logfiles_path'] %>/tomcat.pid

###############################################################################
#   CATALINA_OPTS   Java runtime options used when the "start", "run" or
#                   "debug" command is executed. (ex: heap size and GC logging)
#   Default         -Djava.awt.headless=true
###############################################################################
# java_options
<% if !node['tomcat']['java']['java_options'].empty? %>
CATALINA_OPTS="<%= node['tomcat']['java']['java_options'] %> "
<% end %>
# system_properties
<% if JSON.parse(node['tomcat']['java']['system_properties']).keys.size > 0 %>
  <% JSON.parse(node['tomcat']['java']['system_properties']).each{ |k, v|%>
CATALINA_OPTS="${CATALINA_OPTS}-D<%=k%>=<%=v%> "
  <% } %>
<% end %>
# mem_max
CATALINA_OPTS="${CATALINA_OPTS}-Xmx<%= node['tomcat']['java']['mem_max'] %> "
<% if !node['tomcat']['java']['mem_start'].empty? %>
# mem_start
CATALINA_OPTS="${CATALINA_OPTS}-Xms<%= node['tomcat']['java']['mem_start'] %> "
<% end %>
CATALINA_OPTS="${CATALINA_OPTS}-d64 "
# startup_params
<% JSON.parse(node["tomcat"]['java']['startup_params']).each{ |v|%>
CATALINA_OPTS="${CATALINA_OPTS}-XX:<%=v%> "
<% } %>

###############################################################################
#   CATALINA_OUT    Full path to a file where stdout and stderr will be
#                   redirected.
#   Default         $CATALINA_BASE/logs/catalina.out
###############################################################################
CATALINA_OUT="<%= node['tomcat']['logfiles_path'] %>/catalina.out"

###############################################################################
#   JAVA_OPTS       JVM start parameters for Java.
#   Default         -Djava.awt.headless=true
#                   -Djavax.net.ssl.trustStore="/opt/tomcat/ssl/trust.jks"
###############################################################################
JAVA_OPTS="<%= node['tomcat']['java']['java_options'] %> "
JAVA_OPTS="${JAVA_OPTS}-Xmx<%= node['tomcat']['java']['mem_max'] %> -Xms<%= node['tomcat']['java']['mem_start'] %>"

###############################################################################
#   JVM_TMP         Location of the JVM temporary directory. WARNING: This
#                   directory will be destroyed and recreated at every startup!
#   Default         /var/cache/tomcat/temp
###############################################################################
JVM_TMP=<%= node['tomcat']["tmp_dir"] %>

###############################################################################
#   Export Tomcat Environment Variables
#     Any variables set in the node['tomcat']['environment_settings'] option
#     will be exported to the system for use.
###############################################################################
# environment_settings
<% if JSON.parse(node['tomcat']['global']['environment_settings']).keys.size > 0 %>
<% JSON.parse(node['tomcat']['global']['environment_settings']).each{ |k, v|%>
export <%=k%>="<%=v%>"
<% } %>
<% end %>
